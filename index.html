<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raw Comic Book Grading Tool</title>
    <!-- Use Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Set Inter font for a clean look -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e5e7eb;
            min-height: 100vh;
        }
        
        .main-card {
            background-color: #ffffff;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .grade-display {
            background-color: #4f46e5;
            box-shadow: 0 8px 20px -4px rgba(79, 70, 229, 0.3);
        }
        
        .details-panel {
            background-color: #f1f5f9;
            box-shadow: 0 4px 12px -2px rgba(0, 0, 0, 0.1);
        }
        
        .form-panel {
            background-color: #fafafa;
            box-shadow: 0 6px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        .drawer-panel {
            background-color: #ffffff;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.15);
        }
        
        .glow-effect {
            position: relative;
        }
        
        .tab-button {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .radio-button {
            appearance: none;
            width: 24px;
            height: 24px;
            border: 2px solid #e2e8f0;
            border-radius: 50%;
            background-color: #ffffff;
            box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .radio-button:checked {
            border-width: 3px;
        }

        .radio-button-green:checked {
            background-color: #22c55e;
            border-color: #16a34a;
        }
        
        .radio-button-amber:checked {
            background-color: #f59e0b;
            border-color: #d97706;
        }
        
        .radio-button-red:checked {
            background-color: #ef4444;
            border-color: #dc2626;
        }
        
        .select-input {
            background-color: #ffffff;
            border: 2px solid #e2e8f0;
            box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
        }
        
        .select-input:focus {
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        .container {
            max-width: 800px;
        }
        
        .message-box {
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2);
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 2rem;
            z-index: 1000;
            text-align: center;
        }
        
        /* Zebra stripes and lines for tables and definition lists */
        .stripe-row:nth-child(even) {
            background-color: #f9fafb;
        }

        .horizontal-line {
            border-top: 1px solid #e5e7eb;
        }

        .optgroup-high {
            background-color: #f0fdf4;
            color: #15803d;
        }
        .optgroup-mid {
            background-color: #fffbeb;
            color: #b45309;
        }
        .optgroup-low {
            background-color: #fef2f2;
            color: #b91c1c;
        }

        .radio-cell-green { background-color: #f0fdf4; }
        .radio-cell-yellow { background-color: #fffbeb; }
        .radio-cell-red { background-color: #fef2f2; }

        .tooltip-container {
            position: relative;
            cursor: pointer;
        }
        
        .tooltip-text {
            visibility: hidden;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .tooltip-container:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

    </style>
</head>
<body class="bg-gray-200 flex items-center justify-center min-h-screen p-4 relative">

    <!-- Cheatsheet Drawer Container -->
    <div id="cheatsheet-drawer" class="fixed top-0 left-0 w-80 h-full drawer-panel shadow-2xl z-50 transform -translate-x-full transition-transform duration-300 ease-in-out p-6 overflow-y-auto">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-2xl font-bold text-gray-800">Raw Comic Grading Cheatsheet</h2>
            <button id="close-drawer-btn" class="text-gray-500 hover:text-indigo-600 focus:outline-none transition-colors duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        <div id="cheatsheet-container" class="space-y-4">
            <!-- Cheatsheet content will be dynamically populated -->
        </div>
    </div>

    <!-- Backdrop Overlay -->
    <div id="drawer-backdrop" class="fixed inset-0 bg-black z-40 hidden transition-opacity duration-300 ease-in-out"></div>

    <!-- Main application container -->
    <div class="container main-card rounded-2xl p-6 md:p-12 space-y-8 relative">
        
        <!-- Header Section with Menu and Title -->
        <div class="flex items-center gap-4">
            <!-- Hamburger Menu Button -->
            <button id="open-drawer-btn" class="text-gray-800 hover:text-indigo-600 focus:outline-none z-30 transition-all duration-200 hover:scale-110">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-10 h-10">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                </svg>
            </button>
            <div class="flex flex-col">
                <h1 class="text-3xl md:text-4xl font-extrabold text-gray-800 text-left">Comic Book Grading Tool</h1>
                <p class="text-left text-gray-600 text-lg font-medium">
                    Use this tool to determine the approximate grade of your comic book.
                </p>
            </div>
        </div>

        <!-- Grade Result Display and details aligned to the left -->
        <div class="flex justify-start items-center gap-4">
            <div id="result-display" class="w-48 h-48 grade-display rounded-lg flex-shrink-0 flex flex-col items-center justify-center text-center">
                <p id="final-grade" class="text-7xl font-extrabold text-white">10.0</p>
                <p id="final-grade-note" class="text-white text-sm mt-2 font-semibold">Gem Mint</p>
            </div>
            <div id="grade-details" class="flex-grow text-gray-700 p-6 rounded-xl details-panel">
                <p><strong>Point Deductions:</strong> <span id="details-deductions">0.0-0.1</span></p>
                <p><strong>Defects:</strong> <span id="details-defects">Slight imperfections</span></p>
                <p><strong>Creasing:</strong> <span id="details-creasing">Negligible</span></p>
                <p><strong>Wear:</strong> <span id="details-wear">Negligible</span></p>
                <p><strong>Gloss:</strong> <span id="details-gloss">High Gloss</span></p>
                <p><strong>Interior:</strong> <span id="details-interior">White Pages</span></p>
            </div>
        </div>
        
        <!-- Grading Input Form -->
        <div class="form-panel p-6 rounded-xl border border-gray-200">
            <div class="flex border-b border-gray-300">
                <button id="tab-wear" class="py-3 px-6 font-semibold text-indigo-600 border-b-2 border-indigo-600 focus:outline-none tab-button rounded-t-lg">Wear</button>
                <button id="tab-defects" class="py-3 px-6 font-semibold text-gray-500 focus:outline-none tab-button rounded-t-lg">Defects</button>
                <button id="tab-advanced" class="py-3 px-6 font-semibold text-gray-500 focus:outline-none tab-button rounded-t-lg">Advanced</button>
            </div>
            
            <!-- Wear Tab Content -->
            <div id="wear-content" class="pt-4">
                <hr class="my-4 border-gray-300" />
                <div class="overflow-x-auto">
                    <table class="w-full table-fixed">
                        <thead>
                            <tr>
                                <th class="px-3 py-3 text-left text-gray-700 font-bold w-1/4 bg-gray-100">Area</th>
                                <th class="px-3 py-3 text-center text-gray-700 font-bold w-1/4 bg-gray-100 tooltip-container">
                                    Negligible
                                    <span class="tooltip-text">Can only be seen with magnification.</span>
                                </th>
                                <th class="px-3 py-3 text-center text-gray-700 font-bold w-1/4 bg-gray-100 tooltip-container">
                                    Tiny
                                    <span class="tooltip-text">Can barely be seen but is obvious with magnification.</span>
                                </th>
                                <th class="px-3 py-3 text-center text-gray-700 font-bold w-1/4 bg-gray-100 tooltip-container">
                                    Minor
                                    <span class="tooltip-text">Obvious but very minor and does not significantly detract from the appeal.</span>
                                </th>
                                <th class="px-3 py-3 text-center text-gray-700 font-bold w-1/4 bg-gray-100 tooltip-container">
                                    Moderate
                                    <span class="tooltip-text">Obvious and detracts from the presentation/appeal of the book.</span>
                                </th>
                                <th class="px-3 py-3 text-center text-gray-700 font-bold w-1/4 bg-gray-100 tooltip-container">
                                    Extensive
                                    <span class="tooltip-text">Damage too bad to be considered moderate but not bad enough to be major.</span>
                                </th>
                                <th class="px-3 py-3 text-center text-gray-700 font-bold w-1/4 bg-gray-100 tooltip-container">
                                    Major
                                    <span class="tooltip-text">Unsightly and significantly impacts the presentation/appeal/readability.</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="wear-form">
                            <!-- Rows will be dynamically populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Defects Tab Content (initially hidden) -->
            <div id="defects-content" class="hidden pt-4">
                 <div class="overflow-x-auto">
                    <dl id="defects-dl" class="space-y-1">
                        <!-- Definition list items for each defect category -->
                        
                        <div class="flex flex-col md:flex-row md:items-center space-y-1 md:space-y-0 md:space-x-4 stripe-row horizontal-line p-4">
                            <dt class="w-full md:w-1/3 text-gray-600 font-semibold">Tears/Splits</dt>
                            <dd class="w-full md:w-2/3">
                                <select class="w-full rounded-lg p-3 border border-gray-300 select-input focus:outline-none" name="defects-tears" id="defects-tears">
                                    <optgroup label="High Grade" class="optgroup-high">
                                        <option value="0">None</option>
                                        <option value="0.5">Up to 1/4 inch</option>
                                        <option value="1.0">1/4 to 1/2 inch</option>
                                    </optgroup>
                                    <optgroup label="Mid Grade" class="optgroup-mid">
                                        <option value="1.5">1/2 inch to 1 inch</option>
                                        <option value="2.0">Small tears</option>
                                        <option value="2.5">Several small tears</option>
                                    </optgroup>
                                    <optgroup label="Low Grade" class="optgroup-low">
                                        <option value="3.0">Large tears</option>
                                        <option value="3.5">Many tears</s:l>
                                        <option value="4.0">Large missing pieces</option>
                                    </optgroup>
                                </select>
                            </dd>
                        </div>

                        <div class="flex flex-col md:flex-row md:items-center space-y-1 md:space-y-0 md:space-x-4 stripe-row horizontal-line p-4">
                            <dt class="w-full md:w-1/3 text-gray-600 font-semibold">Stains/Water Damage</dt>
                            <dd class="w-full md:w-2/3">
                                <select class="w-full rounded-lg p-3 border border-gray-300 select-input focus:outline-none" name="defects-stains" id="defects-stains">
                                    <optgroup label="High Grade" class="optgroup-high">
                                        <option value="0">None</option>
                                        <option value="0.5">Light foxing</option>
                                        <option value="1.0">Light water stain</s:l>
                                    </optgroup>
                                    <optgroup label="Mid Grade" class="optgroup-mid">
                                        <option value="1.5">Moderate stain</option>
                                        <option value="2.0">Heavy stain</option>
                                    </optgroup>
                                    <optgroup label="Low Grade" class="optgroup-low">
                                        <option value="3.0">Extensive staining</s:l>
                                        <option value="4.0">Heavy moisture damage</option>
                                    </optgroup>
                                </select>
                            </dd>
                        </div>

                        <div class="flex flex-col md:flex-row md:items-center space-y-1 md:space-y-0 md:space-x-4 stripe-row horizontal-line p-4">
                            <dt class="w-full md:w-1/3 text-gray-600 font-semibold">Tape</dt>
                            <dd class="w-full md:w-2/3">
                                <select class="w-full rounded-lg p-3 border border-gray-300 select-input focus:outline-none" name="defects-tape" id="defects-tape">
                                    <optgroup label="High Grade" class="optgroup-high">
                                        <option value="0">None</option>
                                        <option value="0.5">Slightly discolored</option>
                                        <option value="1.0">Small amount</s:l>
                                    </optgroup>
                                    <optgroup label="Mid Grade" class="optgroup-mid">
                                        <option value="1.5">Moderate amount</option>
                                        <option value="2.0">Discolored/Brittle</option>
                                    </optgroup>
                                    <optgroup label="Low Grade" class="optgroup-low">
                                        <option value="3.0">Extensive amount</option>
                                        <option value="4.0">Major repairs</option>
                                    </optgroup>
                                </select>
                            </dd>
                        </div>
                        
                        <div class="flex flex-col md:flex-row md:items-center space-y-1 md:space-y-0 md:space-x-4 stripe-row horizontal-line p-4">
                            <dt class="w-full md:w-1/3 text-gray-600 font-semibold">Writing</dt>
                            <dd class="w-full md:w-2/3">
                                <select class="w-full rounded-lg p-3 border border-gray-300 select-input focus:outline-none" name="defects-writing" id="defects-writing">
                                    <optgroup label="High Grade" class="optgroup-high">
                                        <option value="0">None</option>
                                        <option value="0.5">Inconspicuous marking</option>
                                        <option value="1.0">Date stamp</option>
                                    </optgroup>
                                    <optgroup label="Mid Grade" class="optgroup-mid">
                                        <option value="1.5">Small price mark</s:l>
                                        <option value="2.0">Small writing</s:l>
                                    </optgroup>
                                    <optgroup label="Low Grade" class="optgroup-low">
                                        <option value="3.0">Large writing</option>
                                        <option value="4.0">Extensive defacing</option>
                                    </optgroup>
                                </select>
                            </dd>
                        </div>
                        
                        <div class="flex flex-col md:flex-row md:items-center space-y-1 md:space-y-0 md:space-x-4 stripe-row horizontal-line p-4">
                            <dt class="w-full md:w-1/3 text-gray-600 font-semibold">Stamps</dt>
                            <dd class="w-full md:w-2/3">
                                <select class="w-full rounded-lg p-3 border border-gray-300 select-input focus:outline-none" name="defects-stamps" id="defects-stamps">
                                    <optgroup label="High Grade" class="optgroup-high">
                                        <option value="0">None</option>
                                        <option value="0.5">Small stamp</option>
                                    </optgroup>
                                    <optgroup label="Mid Grade" class="optgroup-mid">
                                        <option value="1.0">Small, distracting stamp</option>
                                        <option value="1.5">Multiple small stamps</option>
                                    </optgroup>
                                    <optgroup label="Low Grade" class="optgroup-low">
                                        <option value="2.0">Large stamp</option>
                                        <option value="2.5">Multiple large stamps</option>
                                    </optgroup>
                                </select>
                            </dd>
                        </div>
                        
                        <div class="flex flex-col md:flex-row md:items-center space-y-1 md:space-y-0 md:space-x-4 stripe-row horizontal-line p-4">
                            <dt class="w-full md:w-1/3 text-gray-600 font-semibold">Holes/Punches</dt>
                            <dd class="w-full md:w-2/3">
                                <select class="w-full rounded-lg p-3 border border-gray-300 select-input focus:outline-none" name="defects-holes" id="defects-holes">
                                    <optgroup label="High Grade" class="optgroup-high">
                                        <option value="0">None</option>
                                    </optgroup>
                                    <optgroup label="Mid Grade" class="optgroup-mid">
                                        <option value="1.0">Small hole</s:l>
                                        <option value="1.5">Single punch hole</s:l>
                                    </optgroup>
                                    <optgroup label="Low Grade" class="optgroup-low">
                                        <option value="2.0">Large hole</option>
                                        <option value="3.0">Multiple holes</option>
                                    </optgroup>
                                </select>
                            </dd>
                        </div>
                        
                        <div class="flex flex-col md:flex-row md:items-center space-y-1 md:space-y-0 md:space-x-4 stripe-row horizontal-line p-4">
                            <dt class="w-full md:w-1/3 text-gray-600 font-semibold">Other</dt>
                            <dd class="w-full md:w-2/3">
                                <select class="w-full rounded-lg p-3 border border-gray-300 select-input focus:outline-none" name="defects-other" id="defects-other">
                                    <optgroup label="High Grade" class="optgroup-high">
                                        <option value="0">None</option>
                                        <option value="0.5">Slight mis-cut</option>
                                    </optgroup>
                                    <optgroup label="Mid Grade" class="optgroup-mid">
                                        <option value="1.0">Subscription crease</option>
                                        <option value="1.5">Slight foxing</s:l>
                                    </optgroup>
                                    <optgroup label="Low Grade" class="optgroup-low">
                                        <option value="2.0">Severe mis-cut</option>
                                        <option value="3.0">Loose staples</option>
                                    </optgroup>
                                </select>
                            </dd>
                        </div>
                    </dl>
                </div>
            </div>
            
            <!-- Advanced Tab Content (initially hidden) -->
            <div id="advanced-content" class="hidden pt-4">
                <div class="overflow-x-auto">
                    <table class="w-full table-fixed">
                        <thead>
                            <tr>
                                <th class="px-3 py-3 text-left text-gray-700 font-bold w-1/4 bg-gray-100">Defect</th>
                                <th class="px-3 py-3 text-center text-gray-700 font-bold w-1/4 bg-gray-100">Negligible</th>
                                <th class="px-3 py-3 text-center text-gray-700 font-bold w-1/4 bg-gray-100">Tiny</th>
                                <th class="px-3 py-3 text-center text-gray-700 font-bold w-1/4 bg-gray-100">Minor</th>
                                <th class="px-3 py-3 text-center text-gray-700 font-bold w-1/4 bg-gray-100">Moderate</th>
                                <th class="px-3 py-3 text-center text-gray-700 font-bold w-1/4 bg-gray-100">Extensive</th>
                                <th class="px-3 py-3 text-center text-gray-700 font-bold w-1/4 bg-gray-100">Major</th>
                            </tr>
                        </thead>
                        <tbody id="cgc-form">
                            <!-- CGC rows will be dynamically populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="flex justify-start mt-4">
            <button id="reset-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105">
                Reset
            </button>
        </div>
    </div>
    
    <!-- Message box for user notifications -->
    <div id="message-box" class="message-box hidden">
        <div id="message-content"></div>
        <button id="close-message-btn" class="mt-4 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-full">
            Close
        </button>
    </div>

    <script>
        // Data parsed from the "Copy of Improve Collecting Comic Grading Tool - Comic Grading Tool and Cheatsheet.csv" file
        // Hardcoding this data simplifies the tool and makes it self-contained.
        const comicData = [
            { "GRADE": 9.9, "POINT DEDUCTIONS": "0.0-0.1", "DEFECTS": "Slight imperfections", "CREASING": "Negligible", "WEAR": "Negligible", "GLOSS": "High Gloss", "INTERIOR": "White Pages", "NOTES": "Gem Mint" },
            { "GRADE": 9.8, "POINT DEDUCTIONS": "0.0-0.2", "DEFECTS": "Slight imperfections", "CREASING": "Negligible", "WEAR": "Negligible", "GLOSS": "High Gloss", "INTERIOR": "White Pages", "NOTES": "Near Mint/Mint" },
            { "GRADE": 9.6, "POINT DEDUCTIONS": "0.0-0.4", "DEFECTS": "Barely noticeable, minor imperfections", "CREASING": "Negligible", "WEAR": "Negligible", "GLOSS": "High Gloss", "INTERIOR": "White to Off-White Pages", "NOTES": "Near Mint+" },
            { "GRADE": 9.4, "POINT DEDUCTIONS": "0.0-0.6", "DEFECTS": "Minor to barely noticeable imperfections", "CREASING": "Negligible", "WEAR": "Negligible", "GLOSS": "High Gloss", "INTERIOR": "White to Off-White Pages", "NOTES": "Near Mint" },
            { "GRADE": 9.2, "POINT DEDUCTIONS": "0.0-0.8", "DEFECTS": "Minor but obvious imperfections", "CREASING": "Negligible", "WEAR": "Negligible", "GLOSS": "High Gloss", "INTERIOR": "White to Off-White Pages", "NOTES": "Near Mint-" },
            { "GRADE": 9.0, "POINT DEDUCTIONS": "0.0-1.0", "DEFECTS": "Minor but obvious imperfections", "CREASING": "Tiny", "WEAR": "Minor", "GLOSS": "High Gloss", "INTERIOR": "White to Off-White Pages", "NOTES": "Very Fine/Near Mint" },
            { "GRADE": 8.5, "POINT DEDUCTIONS": "0.0-1.5", "DEFECTS": "Minor but obvious imperfections", "CREASING": "Tiny", "WEAR": "Minor", "GLOSS": "High Gloss", "INTERIOR": "White to Off-White Pages", "NOTES": "Very Fine+" },
            { "GRADE": 8.0, "POINT DEDUCTIONS": "0.0-2.0", "DEFECTS": "Minor imperfections", "CREASING": "Tiny", "WEAR": "Minor", "GLOSS": "High Gloss", "INTERIOR": "Off-White to Slight Tan", "NOTES": "Very Fine" },
            { "GRADE": 7.5, "POINT DEDUCTIONS": "0.0-2.5", "DEFECTS": "Minor imperfections", "CREASING": "Tiny", "WEAR": "Minor", "GLOSS": "High Gloss", "INTERIOR": "Off-White to Slight Tan", "NOTES": "Very Fine-" },
            { "GRADE": 7.0, "POINT DEDUCTIONS": "0.0-3.0", "DEFECTS": "Minor imperfections", "CREASING": "Minor", "WEAR": "Minor", "GLOSS": "High Gloss", "INTERIOR": "Off-White to Slight Tan", "NOTES": "Fine/Very Fine" },
            { "GRADE": 6.5, "POINT DEDUCTIONS": "0.0-3.5", "DEFECTS": "Minor imperfections", "CREASING": "Minor", "WEAR": "Minor", "GLOSS": "High Gloss", "INTERIOR": "Off-White to Tan", "NOTES": "Fine+" },
            { "GRADE": 6.0, "POINT DEDUCTIONS": "0.0-4.0", "DEFECTS": "Minor imperfections", "CREASING": "Minor", "WEAR": "Minor", "GLOSS": "Low Gloss", "INTERIOR": "Off-White to Tan", "NOTES": "Fine" },
            { "GRADE": 5.5, "POINT DEDUCTIONS": "0.0-4.5", "DEFECTS": "Minor imperfections", "CREASING": "Moderate", "WEAR": "Moderate", "GLOSS": "Low Gloss", "INTERIOR": "Tan", "NOTES": "Fine-" },
            { "GRADE": 5.0, "POINT DEDUCTIONS": "0.0-5.0", "DEFECTS": "Minor imperfections", "CREASING": "Moderate", "WEAR": "Moderate", "GLOSS": "Low Gloss", "INTERIOR": "Tan", "NOTES": "Very Good/Fine" },
            { "GRADE": 4.5, "POINT DEDUCTIONS": "0.0-5.5", "DEFECTS": "Minor imperfections", "CREASING": "Moderate", "WEAR": "Moderate", "GLOSS": "Low Gloss", "INTERIOR": "Tan", "NOTES": "Very Good+" },
            { "GRADE": 4.0, "POINT DEDUCTIONS": "0.0-6.0", "DEFECTS": "Minor to Major", "CREASING": "Moderate", "WEAR": "Moderate", "GLOSS": "Low Gloss", "INTERIOR": "Tan", "NOTES": "Very Good" },
            { "GRADE": 3.5, "POINT DEDUCTIONS": "0.0-6.5", "DEFECTS": "Minor to Major", "CREASING": "Moderate", "WEAR": "Moderate", "GLOSS": "Low Gloss", "INTERIOR": "Tan", "NOTES": "Very Good-" },
            { "GRADE": 3.0, "POINT DEDUCTIONS": "0.0-7.0", "DEFECTS": "Major to Extensive", "CREASING": "Major", "WEAR": "Major", "GLOSS": "Low Gloss", "INTERIOR": "Tan to Brown", "NOTES": "Good/Very Good" },
            { "GRADE": 2.5, "POINT DEDUCTIONS": "0.0-7.5", "DEFECTS": "Major to Extensive", "CREASING": "Major", "WEAR": "Major", "GLOSS": "Low Gloss", "INTERIOR": "Tan to Brown", "NOTES": "Good+" },
            { "GRADE": 2.0, "POINT DEDUCTIONS": "0.0-8.0", "DEFECTS": "Major to Extensive", "CREASING": "Major", "WEAR": "Major", "GLOSS": "Low Gloss", "INTERIOR": "Brown to Tan", "NOTES": "Good" },
            { "GRADE": 1.8, "POINT DEDUCTIONS": "0.0-8.2", "DEFECTS": "Major to Extensive", "CREASING": "Major", "WEAR": "Major", "GLOSS": "Low Gloss", "INTERIOR": "Brown to Tan", "NOTES": "Good-" },
            { "GRADE": 1.5, "POINT DEDUCTIONS": "0.0-8.5", "DEFECTS": "Major to Extensive", "CREASING": "Extensive", "WEAR": "Extensive", "GLOSS": "Low Gloss", "INTERIOR": "Brown to Tan", "NOTES": "Fair/Good" },
            { "GRADE": 1.0, "POINT DEDUCTIONS": "0.0-9.0", "DEFECTS": "Extensive", "CREASING": "Extensive", "WEAR": "Extensive", "GLOSS": "Low Gloss", "INTERIOR": "Brown to Tan", "NOTES": "Fair" },
            { "GRADE": 0.5, "POINT DEDUCTIONS": "0.0-9.5", "DEFECTS": "Major", "CREASING": "Major", "WEAR": "Major", "GLOSS": "Low Gloss", "INTERIOR": "Brown to Tan", "NOTES": "Poor" },
            { "GRADE": 0.3, "POINT DEDUCTIONS": "0.0-9.7", "DEFECTS": "Extensive", "CREASING": "Extensive", "WEAR": "Extensive", "GLOSS": "None", "INTERIOR": "Brown to Brittle", "NOTES": "Poor" }
        ];

        // Data for defects tab from the CSV file
        const defectsData = [
            {
                category: "Tears/Splits",
                options: {
                    "High Grade": [
                        { text: "None", value: 0 },
                        { text: "Up to 1/4 inch", value: 0.5 },
                        { text: "1/4 to 1/2 inch", value: 1.0 },
                    ],
                    "Mid Grade": [
                        { text: "1/2 inch to 1 inch", value: 1.5 },
                        { text: "Small tears", value: 2.0 },
                        { text: "Several small tears", value: 2.5 },
                    ],
                    "Low Grade": [
                        { text: "Large tears", value: 3.0 },
                        { text: "Many tears", value: 3.5 },
                        { text: "Large missing pieces", value: 4.0 },
                    ],
                },
            },
            {
                category: "Stains/Water Damage",
                options: {
                    "High Grade": [
                        { text: "None", value: 0 },
                        { text: "Light foxing", value: 0.5 },
                        { text: "Light water stain", value: 1.0 },
                    ],
                    "Mid Grade": [
                        { text: "Moderate stain", value: 1.5 },
                        { text: "Heavy stain", value: 2.0 },
                    ],
                    "Low Grade": [
                        { text: "Extensive staining", value: 3.0 },
                        { text: "Heavy moisture damage", value: 4.0 },
                    ],
                },
            },
            {
                category: "Tape",
                options: {
                    "High Grade": [
                        { text: "None", value: 0 },
                        { text: "Slightly discolored", value: 0.5 },
                        { text: "Small amount", value: 1.0 },
                    ],
                    "Mid Grade": [
                        { text: "Moderate amount", value: 1.5 },
                        { text: "Discolored/Brittle", value: 2.0 },
                    ],
                    "Low Grade": [
                        { text: "Extensive amount", value: 3.0 },
                        { text: "Major repairs", value: 4.0 },
                    ],
                },
            },
            {
                category: "Writing",
                options: {
                    "High Grade": [
                        { text: "None", value: 0 },
                        { text: "Inconspicuous marking", value: 0.5 },
                        { text: "Date stamp", value: 1.0 },
                    ],
                    "Mid Grade": [
                        { text: "Small price mark", value: 1.5 },
                        { text: "Small writing", value: 2.0 },
                    ],
                    "Low Grade": [
                        { text: "Large writing", value: 3.0 },
                        { text: "Extensive defacing", value: 4.0 },
                    ],
                },
            },
            {
                category: "Stamps",
                options: {
                    "High Grade": [
                        { text: "None", value: 0 },
                        { text: "Small stamp", value: 0.5 },
                    ],
                    "Mid Grade": [
                        { text: "Small, distracting stamp", value: 1.0 },
                        { text: "Multiple small stamps", value: 1.5 },
                    ],
                    "Low Grade": [
                        { text: "Large stamp", value: 2.0 },
                        { text: "Multiple large stamps", value: 2.5 },
                    ],
                },
            },
            {
                category: "Holes/Punches",
                options: {
                    "High Grade": [
                        { text: "None", value: 0 },
                    ],
                    "Mid Grade": [
                        { text: "Small hole", value: 1.0 },
                        { text: "Single punch hole", value: 1.5 },
                    ],
                    "Low Grade": [
                        { text: "Large hole", value: 2.0 },
                        { text: "Multiple holes", value: 3.0 },
                    ],
                },
            },
            {
                category: "Other",
                options: {
                    "High Grade": [
                        { text: "None", value: 0 },
                        { text: "Slight mis-cut", value: 0.5 },
                    ],
                    "Mid Grade": [
                        { text: "Subscription crease", value: 1.0 },
                        { text: "Slight foxing", value: 1.5 },
                    ],
                    "Low Grade": [
                        { text: "Severe mis-cut", value: 2.0 },
                        { text: "Loose staples", value: 3.0 },
                    ],
                },
            },
        ];
        
        // Define the comic areas and their corresponding defect levels with point deductions for 'Wear' tab
        const comicAreasWear = [
            "Bindery", "Corners", "Edges", "Spine", "Staples", "Cover", "Pages"
        ];
        
        const defectLevels = {
            "Negligible": 0.0,
            "Tiny": 0.2,
            "Minor": 0.5,
            "Moderate": 1.0,
            "Extensive": 1.5,
            "Major": 2.0
        };

        // DOM elements
        const defectFormWear = document.getElementById('wear-form');
        const defectsDl = document.getElementById('defects-dl');
        const finalGradeEl = document.getElementById('final-grade');
        const finalGradeNoteEl = document.getElementById('final-grade-note');
        const detailsDeductionsEl = document.getElementById('details-deductions');
        const detailsDefectsEl = document.getElementById('details-defects');
        const detailsCreasingEl = document.getElementById('details-creasing');
        const detailsWearEl = document.getElementById('details-wear');
        const detailsGlossEl = document.getElementById('details-gloss');
        const detailsInteriorEl = document.getElementById('details-interior');
        const cheatsheetContainer = document.getElementById('cheatsheet-container');
        const messageBox = document.getElementById('message-box');
        const messageContent = document.getElementById('message-content');
        const closeMessageBtn = document.getElementById('close-message-btn');
        const cheatsheetDrawer = document.getElementById('cheatsheet-drawer');
        const openDrawerBtn = document.getElementById('open-drawer-btn');
        const closeDrawerBtn = document.getElementById('close-drawer-btn');
        const drawerBackdrop = document.getElementById('drawer-backdrop');
        const resetBtn = document.getElementById('reset-btn');


        // Tab elements
        const tabWear = document.getElementById('tab-wear');
        const tabDefects = document.getElementById('tab-defects');
        const tabAdvanced = document.getElementById('tab-advanced');
        const wearContent = document.getElementById('wear-content');
        const defectsContent = document.getElementById('defects-content');
        const advancedContent = document.getElementById('advanced-content');


        // Function to display a message box
        function showMessage(message) {
            messageContent.innerHTML = message;
            messageBox.classList.remove('hidden');
        }

        // Close message box on button click
        closeMessageBtn.addEventListener('click', () => {
            messageBox.classList.add('hidden');
        });

        // Function to render the defect selection form with radio buttons for 'Wear' tab
        function renderWearForm() {
            comicAreasWear.forEach((area, rowIndex) => {
                const areaRow = document.createElement('tr');
                areaRow.className = `border-t border-gray-300 ${rowIndex % 2 === 1 ? 'stripe-row' : ''}`;
                
                const areaLabel = document.createElement('td');
                areaLabel.className = 'px-3 py-4 text-left text-gray-800 font-semibold';
                areaLabel.textContent = area;
                areaRow.appendChild(areaLabel);

                // Create a radio button for each defect level
                Object.keys(defectLevels).forEach((level, index) => {
                    const cell = document.createElement('td');
                    cell.className = `px-3 py-4 text-center`;
                    
                    const radioInput = document.createElement('input');
                    radioInput.type = 'radio';
                    radioInput.name = area.toLowerCase(); // Unique name for each group
                    radioInput.value = level;
                    
                    let colorClass = '';
                    if (index < 2) {
                        colorClass = 'radio-button-green';
                    } else if (index < 4) {
                        colorClass = 'radio-button-amber';
                    } else {
                        colorClass = 'radio-button-red';
                    }

                    radioInput.className = `radio-button relative ${colorClass}`;
                    
                    if (index === 0) {
                        radioInput.checked = true; // Default to 'Negligible'
                    }

                    cell.appendChild(radioInput);
                    areaRow.appendChild(cell);
                });

                defectFormWear.appendChild(areaRow);
            });
            // Add a single change listener to the parent form to improve performance
            if (defectFormWear) {
              defectFormWear.addEventListener('change', calculateGrade);
            }
        }
        
        // Function to render the defect selection form for 'Defects' tab
        function renderDefectsForm() {
            // Clear existing content to prevent duplicates
            if (defectsDl) {
              defectsDl.innerHTML = '';
            }
            
            defectsData.forEach((defectCategory, rowIndex) => {
                const flexDiv = document.createElement('div');
                flexDiv.className = `flex flex-col md:flex-row md:items-center space-y-1 md:space-y-0 md:space-x-4 stripe-row horizontal-line p-4`;

                const dt = document.createElement('dt');
                dt.className = 'w-full md:w-1/3 text-gray-600 font-semibold';
                dt.textContent = defectCategory.category;

                const dd = document.createElement('dd');
                dd.className = 'w-full md:w-2/3';

                const select = document.createElement('select');
                select.className = 'w-full rounded-lg p-3 border border-gray-300 select-input focus:outline-none';
                select.name = `defects-${defectCategory.category.toLowerCase().replace(/[\s\/]/g, '-')}`;

                for (const group in defectCategory.options) {
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = group;
                    
                    let optgroupClass = '';
                    if (group.includes('High')) {
                        optgroupClass = 'optgroup-high';
                    } else if (group.includes('Mid')) {
                        optgroupClass = 'optgroup-mid';
                    } else if (group.includes('Low')) {
                        optgroupClass = 'optgroup-low';
                    }
                    optgroup.className = optgroupClass;

                    defectCategory.options[group].forEach(option => {
                        const optionEl = document.createElement('option');
                        optionEl.value = option.value;
                        optionEl.textContent = option.text;
                        optgroup.appendChild(optionEl);
                    });
                    select.appendChild(optgroup);
                }

                dd.appendChild(select);
                flexDiv.appendChild(dt);
                flexDiv.appendChild(dd);
                if (defectsDl) {
                  defectsDl.appendChild(flexDiv);
                }
            });
            if (defectsDl) {
              defectsDl.addEventListener('change', calculateGrade);
            }
        }

        // Function to render the cheatsheet
        function renderCheatsheet() {
            if (cheatsheetContainer) {
              cheatsheetContainer.innerHTML = ''; // Clear loading message
            }
            
            comicData.forEach(item => {
                const card = document.createElement('div');
                card.className = 'bg-white p-6 rounded-xl border border-gray-200 shadow-sm';
                card.innerHTML = `
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Grade: ${item.GRADE} - ${item.NOTES}</h3>
                    <p class="text-gray-700"><strong>Point Deductions:</strong> ${item["POINT DEDUCTIONS"]}</p>
                    <p class="text-gray-700"><strong>Defects:</strong> ${item.DEFECTS}</p>
                    <p class="text-gray-700"><strong>Creasing:</strong> ${item.CREASING}</p>
                    <p class="text-gray-700"><strong>Wear:</strong> ${item.WEAR}</p>
                    <p class="text-gray-700"><strong>Gloss:</strong> ${item.GLOSS}</p>
                    <p class="text-gray-700"><strong>Interior:</strong> ${item.INTERIOR}</p>
                `;
                if (cheatsheetContainer) {
                  cheatsheetContainer.appendChild(card);
                }
            });
        }

        const cgcDefectsGrouped = {
            'Bindery': ['distribution ink', 'bindary chip', 'bindary tear'],
            'Corners': ['bend', 'crease', 'fingerprints', 'shadow'],
            'Edges': ['printer tear', 'tear', 'soiling', 'stain', 'foxing', 'tanning', 'missing piece cover', 'marvel chipping'],
            'Spine': ['stress lines', 'spine roll', 'spine split'],
            'Staples': ['staple rust', 'staple tears', 'staple detached', 'staple holes', 'staple extra (a.m.)', 'staple removed'],
            'Cover': ['stamp', 'crease', 'stain', 'erasure mark', 'marvel tears', 'shadow', 'fingerprints', 'missing piece cover', 'fade', 'marvel chipping', 'name written on cover', 'tape', 'detached wrap', 'detached cover', 'missing page/wrap'],
            'Pages': ['rust stains', 'foxing', 'tanning', 'writing', 'tear', 'missing piece interior', 'detatched page', 'staple removed', 'missing page/wrap']
        };

        const cgcDeductionLevels = ["Negligible", "Tiny", "Minor", "Moderate", "Extensive", "Major"];
        const cgcLevelValues = {
            "Negligible": 0.0, "Tiny": 0.5, "Minor": 1.0, "Moderate": 2.0, "Extensive": 4.0, "Major": 6.0
        };

        const getCgcDeduction = (defect, level) => {
            const deductions = {
                'distribution ink': {"Negligible": 0, "Tiny": 0.0, "Minor": 0.0, "Moderate": 0.0, "Extensive": 0.0, "Major": 0.0},
                'stress lines': {"Negligible": 0.0, "Tiny": 0.2, "Minor": 0.5, "Moderate": 1.5, "Extensive": 3.5, "Major": 5.0},
                'bend': {"Negligible": 0.0, "Tiny": 0.3, "Minor": 0.8, "Moderate": 2.0, "Extensive": 4.0, "Major": 6.5},
                'stamp': {"Negligible": 0.0, "Tiny": 0.3, "Minor": 0.8, "Moderate": 2.0, "Extensive": 4.0, "Major": 6.5},
                'printer tear': {"Negligible": 0.0, "Tiny": 0.2, "Minor": 0.7, "Moderate": 1.5, "Extensive": 3.0, "Major": 5.0},
                'soiling': {"Negligible": 0.0, "Tiny": 0.7, "Minor": 1.2, "Moderate": 2.5, "Extensive": 5.0, "Major": 7.0},
                'bindary chip': {"Negligible": 0.0, "Tiny": 0.0, "Minor": 0.0, "Moderate": 0.0, "Extensive": 0.0, "Major": 0.0},
                'bindary tear': {"Negligible": 0.0, "Tiny": 0.2, "Minor": 0.7, "Moderate": 1.5, "Extensive": 3.0, "Major": 5.0},
                'crease': {"Negligible": 0.0, "Tiny": 0.3, "Minor": 0.8, "Moderate": 2.0, "Extensive": 4.0, "Major": 6.5},
                'stain': {"Negligible": 0.0, "Tiny": 0.7, "Minor": 1.2, "Moderate": 2.5, "Extensive": 5.0, "Major": 7.0},
                'printer hole': {"Negligible": 0.0, "Tiny": 0.0, "Minor": 0.0, "Moderate": 0.0, "Extensive": 0.0, "Major": 0.0},
                'rust stains': {"Negligible": 0.0, "Tiny": 0.0, "Minor": 0.0, "Moderate": 0.0, "Extensive": 0.0, "Major": 0.0},
                'erasure mark': {"Negligible": 0.0, "Tiny": 0.0, "Minor": 0.0, "Moderate": 0.0, "Extensive": 0.0, "Major": 0.0},
                'marvel tears': {"Negligible": 0.0, "Tiny": 0.0, "Minor": 0.0, "Moderate": 0.0, "Extensive": 0.0, "Major": 0.0},
                'shadow': {"Negligible": 0.0, "Tiny": 0.2, "Minor": 0.8, "Moderate": 2.5, "Extensive": 5.0, "Major": 7.5},
                'fingerprints': {"Negligible": 0.0, "Tiny": 0.2, "Minor": 0.8, "Moderate": 2.5, "Extensive": 5.0, "Major": 7.5},
                'staple rust': {"Negligible": 0.0, "Tiny": 0.0, "Minor": 0.0, "Moderate": 0.0, "Extensive": 0.0, "Major": 0.0},
                'staple tears': {"Negligible": 0.0, "Tiny": 0.2, "Minor": 0.8, "Moderate": 2.0, "Extensive": 4.0, "Major": 6.5},
                'foxing': {"Negligible": 0.0, "Tiny": 0.2, "Minor": 0.5, "Moderate": 1.2, "Extensive": 2.2, "Major": 3.5},
                'tanning': {"Negligible": 0.0, "Tiny": 0.2, "Minor": 0.5, "Moderate": 1.2, "Extensive": 2.2, "Major": 3.5},
                'writing': {"Negligible": 0.0, "Tiny": 0.3, "Minor": 0.8, "Moderate": 2.0, "Extensive": 4.0, "Major": 6.5},
                'tear': {"Negligible": 0.0, "Tiny": 0.3, "Minor": 0.8, "Moderate": 2.0, "Extensive": 4.0, "Major": 6.5},
                'missing piece cover': {"Negligible": 0.0, "Tiny": 0.5, "Minor": 1.2, "Moderate": 2.5, "Extensive": 5.0, "Major": 8.0},
                'fade': {"Negligible": 0.0, "Tiny": 0.0, "Minor": 0.0, "Moderate": 0.0, "Extensive": 0.0, "Major": 0.0},
                'marvel chipping': {"Negligible": 0.0, "Tiny": 0.0, "Minor": 0.0, "Moderate": 0.0, "Extensive": 0.0, "Major": 0.0},
                'spine roll': {"Negligible": 0.0, "Tiny": 0.2, "Minor": 0.8, "Moderate": 2.0, "Extensive": 4.0, "Major": 6.5},
                'tape stain': {"Negligible": 0.0, "Tiny": 0.5, "Minor": 1.2, "Moderate": 2.5, "Extensive": 5.0, "Major": 8.0},
                'spine split': {"Negligible": 0.0, "Tiny": 0.5, "Minor": 1.2, "Moderate": 2.5, "Extensive": 5.0, "Major": 8.0},
                'sticker': {"Negligible": 0.0, "Tiny": 0.0, "Minor": 0.0, "Moderate": 0.0, "Extensive": 0.0, "Major": 0.0},
                'name written on cover': {"Negligible": 0.0, "Tiny": 0.2, "Minor": 0.8, "Moderate": 2.0, "Extensive": 4.0, "Major": 6.5},
                'staple detached': {"Negligible": 0.0, "Tiny": 0.5, "Minor": 1.2, "Moderate": 2.5, "Extensive": 5.0, "Major": 8.0},
                'tape': {"Negligible": 0.0, "Tiny": 0.0, "Minor": 0.0, "Moderate": 0.0, "Extensive": 0.0, "Major": 0.0},
                'staple holes': {"Negligible": 0.0, "Tiny": 0.2, "Minor": 0.8, "Moderate": 2.0, "Extensive": 4.0, "Major": 6.5},
                'detached wrap': {"Negligible": 0.0, "Tiny": 0.0, "Minor": 0.0, "Moderate": 0.0, "Extensive": 0.0, "Major": 0.0},
                'staple extra (a.m.)': {"Negligible": 0.0, "Tiny": 0.0, "Minor": 0.0, "Moderate": 0.0, "Extensive": 0.0, "Major": 0.0},
                'detatched page': {"Negligible": 0.0, "Tiny": 0.0, "Minor": 0.0, "Moderate": 0.0, "Extensive": 0.0, "Major": 0.0},
                'staple removed': {"Negligible": 0.0, "Tiny": 0.0, "Minor": 0.0, "Moderate": 0.0, "Extensive": 0.0, "Major": 0.0},
                'missing piece interior': {"Negligible": 0.0, "Tiny": 0.0, "Minor": 0.0, "Moderate": 0.0, "Extensive": 0.0, "Major": 0.0},
                'detached cover': {"Negligible": 0.0, "Tiny": 0.5, "Minor": 1.2, "Moderate": 2.5, "Extensive": 5.0, "Major": 8.0},
                'missing page/wrap': {"Negligible": 0.0, "Tiny": 0.2, "Minor": 0.8, "Moderate": 2.0, "Extensive": 4.0, "Major": 6.5}
            };
            return deductions[defect][level] || 0;
        };
        

        function renderCgcForm() {
            const cgcFormBody = document.getElementById('cgc-form');
            if (!cgcFormBody) return;
            cgcFormBody.innerHTML = '';
            
            const cgcDefectLevels = ["Negligible", "Tiny", "Minor", "Moderate", "Extensive", "Major"];

            Object.keys(cgcDefectsGrouped).forEach((group, groupIndex) => {
                const groupRow = document.createElement('tr');
                groupRow.className = `bg-gray-100 ${groupIndex > 0 ? 'border-t-2 border-gray-300' : ''}`;
                const groupHeader = document.createElement('td');
                groupHeader.colSpan = 7;
                groupHeader.className = 'py-2 px-4 font-bold text-gray-800 text-left';
                groupHeader.textContent = group;
                groupRow.appendChild(groupHeader);
                cgcFormBody.appendChild(groupRow);
                
                cgcDefectsGrouped[group].forEach((defect, rowIndex) => {
                    const row = document.createElement('tr');
                    row.className = rowIndex % 2 === 1 ? 'stripe-row' : '';
                    
                    const labelCell = document.createElement('td');
                    labelCell.className = 'py-2 px-4 border-b border-gray-200 font-medium text-gray-700';
                    labelCell.textContent = defect.charAt(0).toUpperCase() + defect.slice(1);
                    row.appendChild(labelCell);

                    cgcDefectLevels.forEach((level, levelIndex) => {
                        const cell = document.createElement('td');
                        cell.className = 'py-2 px-4 border-b border-gray-200 text-center';
                        
                        const radio = document.createElement('input');
                        radio.type = 'radio';
                        radio.name = `cgc-${defect.replace(/\s/g, '-')}`;
                        radio.value = getCgcDeduction(defect, level);

                        let colorClass = '';
                        if (levelIndex < 2) {
                            colorClass = 'radio-button-green';
                        } else if (levelIndex < 4) {
                            colorClass = 'radio-button-amber';
                        } else {
                            colorClass = 'radio-button-red';
                        }
                        radio.className = `radio-button relative ${colorClass}`;

                        if (levelIndex === 0) {
                            radio.checked = true;
                        }
                        
                        cell.appendChild(radio);
                        row.appendChild(cell);
                    });
                    cgcFormBody.appendChild(row);
                });
            });
            if (cgcFormBody) cgcFormBody.addEventListener('change', calculateGrade);
        }
        
        // Function to render the cheatsheet
        function renderCheatsheet() {
            if (cheatsheetContainer) {
              cheatsheetContainer.innerHTML = ''; // Clear loading message
            }
            
            comicData.forEach(item => {
                const card = document.createElement('div');
                card.className = 'bg-white p-6 rounded-xl border border-gray-200 shadow-sm';
                card.innerHTML = `
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Grade: ${item.GRADE} - ${item.NOTES}</h3>
                    <p class="text-gray-700"><strong>Point Deductions:</strong> ${item["POINT DEDUCTIONS"]}</p>
                    <p class="text-gray-700"><strong>Defects:</strong> ${item.DEFECTS}</p>
                    <p class="text-gray-700"><strong>Creasing:</strong> ${item.CREASING}</p>
                    <p class="text-gray-700"><strong>Wear:</strong> ${item.WEAR}</p>
                    <p class="text-gray-700"><strong>Gloss:</strong> ${item.GLOSS}</p>
                    <p class="text-gray-700"><strong>Interior:</strong> ${item.INTERIOR}</p>
                `;
                if (cheatsheetContainer) {
                  cheatsheetContainer.appendChild(card);
                }
            });
        }

        // Function to calculate the final grade and update details
        function calculateGrade() {
            let totalDeductions = 0;
            let currentTab = 'wear';
            if (wearContent && !wearContent.classList.contains('hidden')) {
                currentTab = 'wear';
            } else if (defectsContent && !defectsContent.classList.contains('hidden')) {
                currentTab = 'defects';
            } else if (advancedContent && !advancedContent.classList.contains('hidden')) {
                currentTab = 'advanced';
            }

            if (currentTab === 'wear') {
                const wearSelections = document.querySelectorAll('#wear-form input[type="radio"]:checked');
                wearSelections.forEach(radioEl => {
                    totalDeductions += defectLevels[radioEl.value];
                });
            } else if (currentTab === 'defects') {
                const defectSelections = document.querySelectorAll('#defects-dl select');
                defectSelections.forEach(selectEl => {
                    totalDeductions += parseFloat(selectEl.value);
                });
            } else if (currentTab === 'advanced') {
                const cgcSelections = document.querySelectorAll('#cgc-form input[type="radio"]:checked');
                cgcSelections.forEach(radioEl => {
                    totalDeductions += parseFloat(radioEl.value);
                });
            }

            // Start with a perfect score (10.0) and subtract points
            let finalScore = 10.0 - totalDeductions;
            
            // Ensure the score is not negative
            if (finalScore < 0) {
                finalScore = 0.0;
            }

            // Find the closest grade from the comicData
            let closestGradeItem = null;
            let minDifference = Infinity;

            comicData.forEach(item => {
                const grade = parseFloat(item.GRADE);
                const difference = Math.abs(finalScore - grade);
                if (difference < minDifference) {
                    minDifference = difference;
                    closestGradeItem = item;
                }
            });

            // Display the final score and update details
            if (totalDeductions === 0) {
                if(finalGradeEl) finalGradeEl.textContent = '10.0';
                if(finalGradeNoteEl) finalGradeNoteEl.textContent = 'Gem Mint';
                // Set initial values for grade details
                const initialDetails = comicData.find(item => item.GRADE === 9.9);
                if(detailsDeductionsEl) detailsDeductionsEl.textContent = initialDetails["POINT DEDUCTIONS"];
                if(detailsDefectsEl) detailsDefectsEl.textContent = initialDetails.DEFECTS;
                if(detailsCreasingEl) detailsCreasingEl.textContent = initialDetails.CREASING;
                if(detailsWearEl) detailsWearEl.textContent = initialDetails.WEAR;
                if(detailsGlossEl) detailsGlossEl.textContent = initialDetails.GLOSS;
                if(detailsInteriorEl) detailsInteriorEl.textContent = initialDetails.INTERIOR;
            } else if (closestGradeItem) {
                if(finalGradeEl) finalGradeEl.textContent = `${closestGradeItem.GRADE}`;
                if(finalGradeNoteEl) finalGradeNoteEl.textContent = closestGradeItem.NOTES;
                // Update details based on the new closest grade
                if(detailsDeductionsEl) detailsDeductionsEl.textContent = closestGradeItem["POINT DEDUCTIONS"];
                if(detailsDefectsEl) detailsDefectsEl.textContent = closestGradeItem.DEFECTS;
                if(detailsCreasingEl) detailsCreasingEl.textContent = closestGradeItem.CREASING;
                if(detailsWearEl) detailsWearEl.textContent = closestGradeItem.WEAR;
                if(detailsGlossEl) detailsGlossEl.textContent = closestGradeItem.GLOSS;
                if(detailsInteriorEl) detailsInteriorEl.textContent = closestGradeItem.INTERIOR;
            } else {
                if(finalGradeEl) finalGradeEl.textContent = '--';
                if(finalGradeNoteEl) finalGradeNoteEl.textContent = '';
                if(detailsDeductionsEl) detailsDeductionsEl.textContent = '';
                if(detailsDefectsEl) detailsDefectsEl.textContent = '';
                if(detailsCreasingEl) detailsCreasingEl.textContent = '';
                if(detailsWearEl) detailsWearEl.textContent = '';
                if(detailsGlossEl) detailsGlossEl.textContent = '';
                if(detailsInteriorEl) detailsInteriorEl.textContent = '';
            }
        }

        // Reset function
        function resetForm() {
            // Reset all radio buttons to the first option (Negligible)
            const wearRadioGroups = document.querySelectorAll('#wear-form tr');
            wearRadioGroups.forEach(row => {
                const firstRadio = row.querySelector('input[type="radio"]');
                if (firstRadio) {
                    firstRadio.checked = true;
                }
            });

            // Reset all select dropdowns to the first option (None)
            const selectDropdowns = document.querySelectorAll('#defects-dl select');
            selectDropdowns.forEach(select => {
                select.selectedIndex = 0;
            });
            
            // Reset all CGC radios to the first option (Negligible)
            const cgcRadios = document.querySelectorAll('#cgc-form input[type="radio"]');
            cgcRadios.forEach(radio => {
                // Find the first radio button in each group (which corresponds to Negligible)
                const groupName = radio.name;
                const firstRadioInGroup = document.querySelector(`input[name="${groupName}"][value="0"]`);
                if (firstRadioInGroup) {
                    firstRadioInGroup.checked = true;
                }
            });

            // Recalculate the grade after resetting
            calculateGrade();
        }

        // Tab functionality
        tabWear.addEventListener('click', () => {
            tabWear.classList.add('text-indigo-600', 'border-b-2', 'border-indigo-600');
            if (tabDefects) {
                tabDefects.classList.remove('text-indigo-600', 'border-b-2', 'border-indigo-600');
                tabDefects.classList.add('text-gray-500');
            }
            if (tabAdvanced) {
                tabAdvanced.classList.remove('text-indigo-600', 'border-b-2', 'border-indigo-600');
                tabAdvanced.classList.add('text-gray-500');
            }
            if (wearContent) wearContent.classList.remove('hidden');
            if (defectsContent) defectsContent.classList.add('hidden');
            if (advancedContent) advancedContent.classList.add('hidden');
            calculateGrade();
        });

        tabDefects.addEventListener('click', () => {
            if (tabDefects) {
                tabDefects.classList.add('text-indigo-600', 'border-b-2', 'border-indigo-600');
            }
            if (tabWear) {
                tabWear.classList.remove('text-indigo-600', 'border-b-2', 'border-indigo-600');
                tabWear.classList.add('text-gray-500');
            }
            if (tabAdvanced) {
                tabAdvanced.classList.remove('text-indigo-600', 'border-b-2', 'border-indigo-600');
                tabAdvanced.classList.add('text-gray-500');
            }
            if (defectsContent) defectsContent.classList.remove('hidden');
            if (wearContent) wearContent.classList.add('hidden');
            if (advancedContent) advancedContent.classList.add('hidden');
            calculateGrade();
        });
        
        if(tabAdvanced) {
            tabAdvanced.addEventListener('click', () => {
                tabAdvanced.classList.add('text-indigo-600', 'border-b-2', 'border-indigo-600');
                if (tabWear) {
                    tabWear.classList.remove('text-indigo-600', 'border-b-2', 'border-indigo-600');
                    tabWear.classList.add('text-gray-500');
                }
                if (tabDefects) {
                    tabDefects.classList.remove('text-indigo-600', 'border-b-2', 'border-indigo-600');
                    tabDefects.classList.add('text-gray-500');
                }
                if (advancedContent) advancedContent.classList.remove('hidden');
                if (wearContent) wearContent.classList.add('hidden');
                if (defectsContent) defectsContent.classList.add('hidden');
                calculateGrade();
            });
        }
        
        // Drawer functionality
        openDrawerBtn.addEventListener('click', () => {
            cheatsheetDrawer.classList.remove('-translate-x-full');
            drawerBackdrop.classList.remove('hidden');
            setTimeout(() => {
                drawerBackdrop.classList.add('opacity-50');
            }, 10);
        });

        const closeDrawer = () => {
            cheatsheetDrawer.classList.add('-translate-x-full');
            drawerBackdrop.classList.remove('opacity-50');
            setTimeout(() => {
                drawerBackdrop.classList.add('hidden');
            }, 300); // Wait for transition to finish before hiding
        };

        closeDrawerBtn.addEventListener('click', closeDrawer);
        drawerBackdrop.addEventListener('click', closeDrawer);

        // Event listener for the reset button
        if (resetBtn) {
          resetBtn.addEventListener('click', resetForm);
        }

        // Initial setup on page load
        document.addEventListener('DOMContentLoaded', () => {
            renderWearForm();
            renderDefectsForm();
            renderCheatsheet();
            renderCgcForm();
            // Initial call to set the grade to 10.0 on load
            calculateGrade();
        });

    </script>
</body>
</html>
